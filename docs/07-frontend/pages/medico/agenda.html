<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda | Sistema de Consultas M√©dicas</title>
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <style>
        .dashboard-grid{display:grid;grid-template-columns:250px 1fr;min-height:100vh;background-color:var(--bg-secondary)}.dashboard-sidebar{background-color:white;box-shadow:var(--shadow-md);padding:var(--space-6);display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow-y:auto}.sidebar-brand{display:flex;align-items:center;gap:var(--space-3);margin-bottom:var(--space-8);padding-bottom:var(--space-6);border-bottom:2px solid var(--border-light)}.sidebar-brand-icon{font-size:var(--text-4xl)}.sidebar-brand-text{font-size:var(--text-lg);font-weight:700;color:var(--primary-500)}.sidebar-user{background-color:var(--primary-50);padding:var(--space-4);border-radius:var(--radius-lg);margin-bottom:var(--space-6)}.sidebar-user-name{font-weight:700;color:var(--text-primary);margin-bottom:var(--space-1)}.sidebar-user-role{font-size:var(--text-sm);color:var(--text-secondary)}.sidebar-nav{flex:1}.sidebar-nav-item{list-style:none;margin-bottom:var(--space-2)}.sidebar-nav-link{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-3) var(--space-4);color:var(--text-secondary);text-decoration:none;border-radius:var(--radius-lg);font-weight:500;transition:all var(--transition-fast)}.sidebar-nav-link:hover{background-color:var(--primary-50);color:var(--primary-600)}.sidebar-nav-link.active{background-color:var(--primary-500);color:white}.sidebar-nav-icon{font-size:var(--text-xl)}.sidebar-footer{padding-top:var(--space-6);border-top:2px solid var(--border-light)}.dashboard-main{padding:var(--space-8);overflow-y:auto}.dashboard-header{margin-bottom:var(--space-8)}.dashboard-title{font-size:var(--text-3xl);font-weight:700;color:var(--text-primary);margin-bottom:var(--space-2)}.dashboard-subtitle{font-size:var(--text-lg);color:var(--text-secondary)}.calendar-controls{display:flex;justify-content:space-between;align-items:center;background-color:white;padding:var(--space-4);border-radius:var(--radius-xl);box-shadow:var(--shadow-sm);margin-bottom:var(--space-6)}.calendar-nav{display:flex;align-items:center;gap:var(--space-3)}.calendar-month{font-size:var(--text-xl);font-weight:700;color:var(--text-primary);min-width:200px;text-align:center}.view-toggle{display:flex;gap:var(--space-2)}.calendar-container{background-color:white;border-radius:var(--radius-2xl);padding:var(--space-6);box-shadow:var(--shadow-sm)}.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:var(--space-2)}.calendar-header{padding:var(--space-3);text-align:center;font-weight:700;color:var(--text-primary);background-color:var(--gray-50);border-radius:var(--radius-lg)}.calendar-day{min-height:100px;padding:var(--space-3);border:2px solid var(--border-light);border-radius:var(--radius-lg);cursor:pointer;transition:all var(--transition-fast)}.calendar-day:hover{border-color:var(--primary-300);background-color:var(--primary-50)}.calendar-day.other-month{opacity:0.3}.calendar-day.today{background-color:var(--primary-100);border-color:var(--primary-500)}.day-number{font-weight:700;color:var(--text-primary);margin-bottom:var(--space-2)}.day-events{display:flex;flex-direction:column;gap:var(--space-1)}.event-item{font-size:var(--text-xs);padding:var(--space-1) var(--space-2);border-radius:var(--radius-sm);background-color:var(--primary-500);color:white;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.event-programada{background-color:var(--warning-500)}.event-confirmada{background-color:var(--info-500)}.event-atendida{background-color:var(--success-500)}.list-view{display:none}.list-view.active{display:block}.agenda-list{display:grid;gap:var(--space-3)}.agenda-item{padding:var(--space-4);border:2px solid var(--border-light);border-radius:var(--radius-lg);transition:all var(--transition-fast)}.agenda-item:hover{border-color:var(--primary-300);background-color:var(--primary-50)}.agenda-time{font-weight:700;color:var(--primary-600);margin-bottom:var(--space-2)}.agenda-patient{font-size:var(--text-lg);font-weight:600;color:var(--text-primary);margin-bottom:var(--space-1)}.agenda-details{color:var(--text-secondary);font-size:var(--text-sm)}@media (max-width:768px){.dashboard-grid{grid-template-columns:1fr}.dashboard-sidebar{display:none}.calendar-grid{grid-template-columns:1fr}.calendar-day{min-height:60px}}
    </style>
</head>
<body>
    <div class="dashboard-grid">
        <aside class="dashboard-sidebar">
            <div class="sidebar-brand"><span class="sidebar-brand-icon">üè•</span><span class="sidebar-brand-text">MediConsultas</span></div>
            <div class="sidebar-user"><div class="sidebar-user-name" id="userName">Cargando...</div><div class="sidebar-user-role">M√©dico</div></div>
            <nav class="sidebar-nav">
                <ul style="list-style:none;padding:0;margin:0">
                    <li class="sidebar-nav-item"><a href="/pages/medico/dashboard.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üè†</span><span>Dashboard</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/medico/agenda.html" class="sidebar-nav-link active"><span class="sidebar-nav-icon">üìÖ</span><span>Agenda</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/medico/horarios.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üïê</span><span>Horarios</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/medico/pacientes.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üë•</span><span>Pacientes</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/medico/perfil.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üë§</span><span>Mi Perfil</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><button class="btn btn-danger btn-block" id="logoutBtn"><span>üö™</span><span>Cerrar Sesi√≥n</span></button></div>
        </aside>
        <main class="dashboard-main">
            <div class="dashboard-header animate-fade-in"><h1 class="dashboard-title">Mi Agenda</h1><p class="dashboard-subtitle">Visualice sus citas programadas</p></div>
            <div class="calendar-controls animate-slide-up">
                <div class="calendar-nav">
                    <button class="btn btn-ghost" id="prevMonth">‚óÄ Anterior</button>
                    <div class="calendar-month" id="currentMonth">Cargando...</div>
                    <button class="btn btn-ghost" id="nextMonth">Siguiente ‚ñ∂</button>
                </div>
                <div class="view-toggle">
                    <button class="btn btn-primary" id="calendarViewBtn">üìÖ Calendario</button>
                    <button class="btn btn-ghost" id="listViewBtn">üìã Lista</button>
                </div>
            </div>
            <div id="calendarView" class="calendar-container animate-slide-up" style="animation-delay:0.1s">
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            <div id="listView" class="list-view calendar-container">
                <div class="agenda-list" id="agendaList"></div>
            </div>
        </main>
    </div>
    <script src="/js/main.js"></script>
    <script src="/js/utils/auth-guard.js"></script>
    <script>
        let currentDate=new Date(),citas=[],currentView='calendar';const DIAS=['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'],MESES=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];document.addEventListener('DOMContentLoaded',async()=>{const user=getCurrentUser();if(!user||user.rol!=='MEDICO'){window.location.href='/pages/auth/login.html';return}document.getElementById('userName').textContent=user.username;document.getElementById('logoutBtn').addEventListener('click',()=>{logout();window.location.href='/pages/auth/login.html'});document.getElementById('prevMonth').addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()-1);renderCalendar()});document.getElementById('nextMonth').addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()+1);renderCalendar()});document.getElementById('calendarViewBtn').addEventListener('click',()=>{currentView='calendar';updateViewToggle();document.getElementById('calendarView').style.display='block';document.getElementById('listView').classList.remove('active')});document.getElementById('listViewBtn').addEventListener('click',()=>{currentView='list';updateViewToggle();document.getElementById('calendarView').style.display='none';document.getElementById('listView').classList.add('active');renderListView()});await loadCitas();renderCalendar()});function updateViewToggle(){if(currentView==='calendar'){document.getElementById('calendarViewBtn').className='btn btn-primary';document.getElementById('listViewBtn').className='btn btn-ghost'}else{document.getElementById('calendarViewBtn').className='btn btn-ghost';document.getElementById('listViewBtn').className='btn btn-primary'}}async function loadCitas(){const user=getCurrentUser(),token=getToken();try{const response=await fetch(`${API_BASE_URL}/citas/medico/${user.idReferencia}`,{headers:{'Authorization':`Bearer ${token}`}});citas=await response.json()}catch(error){console.error('Error:',error)}}function renderCalendar(){const year=currentDate.getFullYear(),month=currentDate.getMonth();document.getElementById('currentMonth').textContent=`${MESES[month]} ${year}`;const firstDay=new Date(year,month,1).getDay(),daysInMonth=new Date(year,month+1,0).getDate(),prevMonthDays=new Date(year,month,0).getDate();const grid=document.getElementById('calendarGrid');let html='';DIAS.forEach(dia=>{html+=`<div class="calendar-header">${dia}</div>`});for(let i=firstDay-1;i>=0;i--){const day=prevMonthDays-i;html+=`<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`}const today=new Date();for(let day=1;day<=daysInMonth;day++){const date=new Date(year,month,day),dateStr=date.toISOString().split('T')[0],isToday=dateStr===today.toISOString().split('T')[0],dayCitas=citas.filter(c=>c.fechaCita===dateStr&&(c.estado==='PROGRAMADA'||c.estado==='CONFIRMADA'));let eventsHtml='';dayCitas.slice(0,3).forEach(c=>{const hora=c.horaCita||'--:--',className=c.estado==='PROGRAMADA'?'event-programada':c.estado==='CONFIRMADA'?'event-confirmada':'';eventsHtml+=`<div class="event-item ${className}" title="${c.nombrePaciente}">${hora} ${c.nombrePaciente||'Paciente'}</div>`});if(dayCitas.length>3)eventsHtml+=`<div class="event-item" style="background-color:var(--gray-500)">+${dayCitas.length-3} m√°s</div>`;html+=`<div class="calendar-day ${isToday?'today':''}"><div class="day-number">${day}</div><div class="day-events">${eventsHtml}</div></div>`}const remainingDays=42-(firstDay+daysInMonth);for(let day=1;day<=remainingDays;day++){html+=`<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`}grid.innerHTML=html}function renderListView(){const hoy=new Date(),proximas=citas.filter(c=>new Date(c.fechaCita)>=hoy&&(c.estado==='PROGRAMADA'||c.estado==='CONFIRMADA')).sort((a,b)=>new Date(a.fechaCita)-new Date(b.fechaCita));const list=document.getElementById('agendaList');if(proximas.length===0){list.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p class="empty-state-text">No hay citas pr√≥ximas</p></div>';return}list.innerHTML=proximas.map(c=>{const fecha=new Date(c.fechaCita),fechaStr=fecha.toLocaleDateString('es-PE',{weekday:'long',day:'numeric',month:'long',year:'numeric'}),estadoColors={PROGRAMADA:'var(--warning-600)',CONFIRMADA:'var(--info-600)'};return`<div class="agenda-item"><div class="agenda-time" style="color:${estadoColors[c.estado]}">${c.horaCita||'--:--'} - ${fechaStr}</div><div class="agenda-patient">${c.nombrePaciente||'Paciente sin nombre'}</div><div class="agenda-details">üìã ${c.motivoConsulta||'Sin motivo especificado'}</div><div class="agenda-details">üè• ${c.consultorio||'Consultorio por asignar'}</div><div class="agenda-details" style="margin-top:var(--space-2)"><span class="badge ${c.estado==='PROGRAMADA'?'status-programada':'status-confirmada'}">${c.estado}</span></div></div>`}).join('')}
    </script>
</body>
</html>
