<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Citas | Sistema de Consultas M√©dicas</title>
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
    <style>
        .dashboard-grid{display:grid;grid-template-columns:250px 1fr;min-height:100vh;background-color:var(--bg-secondary)}.dashboard-sidebar{background-color:white;box-shadow:var(--shadow-md);padding:var(--space-6);display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow-y:auto}.sidebar-brand{display:flex;align-items:center;gap:var(--space-3);margin-bottom:var(--space-8);padding-bottom:var(--space-6);border-bottom:2px solid var(--border-light)}.sidebar-brand-icon{font-size:var(--text-4xl)}.sidebar-brand-text{font-size:var(--text-lg);font-weight:700;color:var(--primary-500)}.sidebar-user{background-color:var(--primary-50);padding:var(--space-4);border-radius:var(--radius-lg);margin-bottom:var(--space-6)}.sidebar-user-name{font-weight:700;color:var(--text-primary);margin-bottom:var(--space-1)}.sidebar-user-role{font-size:var(--text-sm);color:var(--text-secondary)}.sidebar-nav{flex:1}.sidebar-nav-item{list-style:none;margin-bottom:var(--space-2)}.sidebar-nav-link{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-3) var(--space-4);color:var(--text-secondary);text-decoration:none;border-radius:var(--radius-lg);font-weight:500;transition:all var(--transition-fast)}.sidebar-nav-link:hover{background-color:var(--primary-50);color:var(--primary-600)}.sidebar-nav-link.active{background-color:var(--primary-500);color:white}.sidebar-nav-icon{font-size:var(--text-xl)}.sidebar-footer{padding-top:var(--space-6);border-top:2px solid var(--border-light)}.dashboard-main{padding:var(--space-8);overflow-y:auto}.dashboard-header{margin-bottom:var(--space-8)}.dashboard-title{font-size:var(--text-3xl);font-weight:700;color:var(--text-primary);margin-bottom:var(--space-2)}.dashboard-subtitle{font-size:var(--text-lg);color:var(--text-secondary)}.toolbar{display:flex;flex-wrap:wrap;gap:var(--space-3);margin-bottom:var(--space-6);background-color:white;padding:var(--space-4);border-radius:var(--radius-xl);box-shadow:var(--shadow-sm)}.search-box{position:relative;flex:1;min-width:250px}.search-box input{width:100%;padding:var(--space-3) var(--space-4) var(--space-3) var(--space-10);border:2px solid var(--border-light);border-radius:var(--radius-lg);font-size:var(--text-base);transition:all var(--transition-fast)}.search-box input:focus{outline:none;border-color:var(--primary-400);box-shadow:0 0 0 3px var(--primary-100)}.search-icon{position:absolute;left:var(--space-3);top:50%;transform:translateY(-50%);font-size:var(--text-xl);color:var(--text-secondary)}.filter-select{padding:var(--space-3) var(--space-4);border:2px solid var(--border-light);border-radius:var(--radius-lg);font-size:var(--text-base);background-color:white;min-width:150px}.table-container{background-color:white;border-radius:var(--radius-2xl);padding:var(--space-6);box-shadow:var(--shadow-sm)}.table{width:100%;border-collapse:collapse}.table thead{background-color:var(--gray-50);border-bottom:2px solid var(--border-light)}.table th{padding:var(--space-4);text-align:left;font-weight:700;color:var(--text-primary);font-size:var(--text-sm)}.table td{padding:var(--space-4);border-bottom:1px solid var(--border-light);color:var(--text-secondary)}.table tbody tr:hover{background-color:var(--gray-50)}.badge{display:inline-block;padding:var(--space-2) var(--space-3);border-radius:var(--radius-lg);font-size:var(--text-sm);font-weight:600}.status-programada{background-color:var(--warning-100);color:var(--warning-700)}.status-confirmada{background-color:var(--info-100);color:var(--info-700)}.status-atendida{background-color:var(--success-100);color:var(--success-700)}.status-cancelada{background-color:var(--error-100);color:var(--error-700)}@media (max-width:768px){.dashboard-grid{grid-template-columns:1fr}.dashboard-sidebar{display:none}.toolbar{flex-direction:column}.filter-select,.search-box{width:100%;min-width:100%}}
    </style>
</head>
<body>
    <div class="dashboard-grid">
        <aside class="dashboard-sidebar">
            <div class="sidebar-brand"><span class="sidebar-brand-icon">üè•</span><span class="sidebar-brand-text">MediConsultas</span></div>
            <div class="sidebar-user"><div class="sidebar-user-name" id="userName">Cargando...</div><div class="sidebar-user-role">Administrador</div></div>
            <nav class="sidebar-nav">
                <ul style="list-style:none;padding:0;margin:0">
                    <li class="sidebar-nav-item"><a href="/pages/admin/dashboard.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üè†</span><span>Dashboard</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/especialidades.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">‚öïÔ∏è</span><span>Especialidades</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/medicos.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üë®‚Äç‚öïÔ∏è</span><span>M√©dicos</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/pacientes.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üë•</span><span>Pacientes</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/consultorios.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üö™</span><span>Consultorios</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/citas.html" class="sidebar-nav-link active"><span class="sidebar-nav-icon">üìÖ</span><span>Citas</span></a></li>
                    <li class="sidebar-nav-item"><a href="/pages/admin/reportes.html" class="sidebar-nav-link"><span class="sidebar-nav-icon">üìä</span><span>Reportes</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><button class="btn btn-danger btn-block" id="logoutBtn"><span>üö™</span><span>Cerrar Sesi√≥n</span></button></div>
        </aside>
        <main class="dashboard-main">
            <div class="dashboard-header animate-fade-in"><h1 class="dashboard-title">Gesti√≥n de Citas</h1><p class="dashboard-subtitle">Visualice y administre todas las citas m√©dicas</p></div>
            <div class="toolbar animate-slide-up">
                <div class="search-box"><span class="search-icon">üîç</span><input type="text" id="searchInput" placeholder="Buscar por paciente o m√©dico..."></div>
                <select id="estadoFilter" class="filter-select"><option value="">Todos los estados</option><option value="PROGRAMADA">Programada</option><option value="CONFIRMADA">Confirmada</option><option value="ATENDIDA">Atendida</option><option value="CANCELADA">Cancelada</option><option value="NO_PRESENTADO">No Presentado</option></select>
                <select id="especialidadFilter" class="filter-select"><option value="">Todas las especialidades</option></select>
                <input type="date" id="fechaFilter" class="filter-select" style="min-width:180px">
            </div>
            <div class="table-container animate-slide-up" style="animation-delay:0.1s">
                <div id="tableContent"><div class="spinner-container"><div class="spinner"></div><p>Cargando citas...</p></div></div>
            </div>
        </main>
    </div>
    <script src="/js/main.js"></script>
    <script src="/js/utils/auth-guard.js"></script>
    <script>
        let citas=[],especialidades=[];document.addEventListener('DOMContentLoaded',async()=>{const user=getCurrentUser();if(!user||user.rol!=='ADMIN'){window.location.href='/pages/auth/login.html';return}document.getElementById('userName').textContent=user.username;document.getElementById('logoutBtn').addEventListener('click',()=>{logout();window.location.href='/pages/auth/login.html'});document.getElementById('searchInput').addEventListener('input',filterTable);document.getElementById('estadoFilter').addEventListener('change',filterTable);document.getElementById('especialidadFilter').addEventListener('change',filterTable);document.getElementById('fechaFilter').addEventListener('change',filterTable);await loadEspecialidades();await loadCitas()});async function loadEspecialidades(){const token=getToken();try{const response=await fetch(`${API_BASE_URL}/especialidades`,{headers:{'Authorization':`Bearer ${token}`}});especialidades=await response.json();const filter=document.getElementById('especialidadFilter');filter.innerHTML='<option value="">Todas las especialidades</option>'+especialidades.map(e=>`<option value="${e.nombre}">${e.nombre}</option>`).join('')}catch(error){console.error('Error:',error)}}async function loadCitas(){const token=getToken(),container=document.getElementById('tableContent');try{const response=await fetch(`${API_BASE_URL}/citas`,{headers:{'Authorization':`Bearer ${token}`}});citas=await response.json();renderTable(citas)}catch(error){console.error('Error:',error);container.innerHTML='<p style=\"text-align:center;color:var(--error-600)\">Error al cargar citas</p>'}}function filterTable(){const search=document.getElementById('searchInput').value.toLowerCase(),estado=document.getElementById('estadoFilter').value,especialidad=document.getElementById('especialidadFilter').value,fecha=document.getElementById('fechaFilter').value;let filtered=citas;if(search){filtered=filtered.filter(c=>(c.nombrePaciente||'').toLowerCase().includes(search)||(c.nombreMedico||'').toLowerCase().includes(search))}if(estado){filtered=filtered.filter(c=>c.estado===estado)}if(especialidad){filtered=filtered.filter(c=>c.especialidad===especialidad)}if(fecha){filtered=filtered.filter(c=>c.fechaCita.startsWith(fecha))}renderTable(filtered)}function renderTable(data){const container=document.getElementById('tableContent');if(data.length===0){container.innerHTML='<div class=\"empty-state\"><div class=\"empty-state-icon\">üìÖ</div><p class=\"empty-state-text\">No hay citas que coincidan con los filtros</p></div>';return}const estadoClasses={'PROGRAMADA':'status-programada','CONFIRMADA':'status-confirmada','ATENDIDA':'status-atendida','CANCELADA':'status-cancelada','NO_PRESENTADO':'status-cancelada'};container.innerHTML=`<table class=\"table\"><thead><tr><th>Fecha/Hora</th><th>Paciente</th><th>M√©dico</th><th>Especialidad</th><th>Estado</th><th>Consultorio</th></tr></thead><tbody>${data.map(c=>{const fecha=new Date(c.fechaCita),fechaStr=fecha.toLocaleDateString('es-PE',{day:'2-digit',month:'2-digit',year:'numeric'}),horaStr=c.horaCita||fecha.toLocaleTimeString('es-PE',{hour:'2-digit',minute:'2-digit'});return`<tr><td><strong>${fechaStr}</strong><br><small>${horaStr}</small></td><td>${c.nombrePaciente||'N/A'}</td><td>Dr(a). ${c.nombreMedico||'No asignado'}</td><td><small>${c.especialidad||'-'}</small></td><td><span class=\"badge ${estadoClasses[c.estado]}\">${c.estado}</span></td><td>${c.consultorio||'-'}</td></tr>`}).join('')}</tbody></table>`}
    </script>
</body>
</html>
