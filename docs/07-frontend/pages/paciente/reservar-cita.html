<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reservar Cita M√©dica - Sistema de Consultas">
    <title>Reservar Cita | Sistema de Consultas M√©dicas</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">

    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
            background-color: var(--bg-secondary);
        }

        .dashboard-sidebar {
            background-color: white;
            box-shadow: var(--shadow-md);
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-8);
            padding-bottom: var(--space-6);
            border-bottom: 2px solid var(--border-light);
        }

        .sidebar-brand-icon {
            font-size: var(--text-4xl);
        }

        .sidebar-brand-text {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--primary-500);
        }

        .sidebar-user {
            background-color: var(--primary-50);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
        }

        .sidebar-user-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .sidebar-user-role {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .sidebar-nav {
            flex: 1;
        }

        .sidebar-nav-item {
            list-style: none;
            margin-bottom: var(--space-2);
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-lg);
            font-weight: 500;
            transition: all var(--transition-fast);
        }

        .sidebar-nav-link:hover {
            background-color: var(--primary-50);
            color: var(--primary-600);
        }

        .sidebar-nav-link.active {
            background-color: var(--primary-500);
            color: white;
        }

        .sidebar-nav-icon {
            font-size: var(--text-xl);
        }

        .sidebar-footer {
            padding-top: var(--space-6);
            border-top: 2px solid var(--border-light);
        }

        .dashboard-main {
            padding: var(--space-8);
            overflow-y: auto;
        }

        .dashboard-header {
            margin-bottom: var(--space-8);
        }

        .dashboard-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }

        .dashboard-subtitle {
            font-size: var(--text-lg);
            color: var(--text-secondary);
        }

        /* Stepper */
        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-8);
            background-color: white;
            padding: var(--space-6);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-sm);
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 1.5rem;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: var(--gray-200);
            z-index: 0;
        }

        .step.active:not(:last-child)::after {
            background-color: var(--primary-500);
        }

        .step-circle {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-full);
            background-color: var(--gray-200);
            color: var(--gray-500);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--text-lg);
            margin-bottom: var(--space-2);
            position: relative;
            z-index: 1;
            border: 3px solid white;
        }

        .step.active .step-circle {
            background-color: var(--primary-500);
            color: white;
        }

        .step.completed .step-circle {
            background-color: var(--success-500);
            color: white;
        }

        .step-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .step.active .step-label {
            color: var(--primary-600);
        }

        /* Form Content */
        .form-content {
            background-color: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-sm);
            min-height: 400px;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .doctor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-4);
        }

        .doctor-card {
            border: 2px solid var(--border-light);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .doctor-card:hover {
            border-color: var(--primary-300);
            box-shadow: var(--shadow-md);
        }

        .doctor-card.selected {
            border-color: var(--primary-500);
            background-color: var(--primary-50);
        }

        .doctor-info {
            display: flex;
            gap: var(--space-3);
        }

        .doctor-avatar {
            width: 3.5rem;
            height: 3.5rem;
            background-color: var(--primary-100);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-2xl);
            flex-shrink: 0;
        }

        .doctor-details h4 {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .doctor-details p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .time-slot {
            padding: var(--space-3);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 600;
        }

        .time-slot:hover:not(.disabled) {
            border-color: var(--primary-300);
            background-color: var(--primary-50);
        }

        .time-slot.selected {
            border-color: var(--primary-500);
            background-color: var(--primary-500);
            color: white;
        }

        .time-slot.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--gray-100);
        }

        .summary-card {
            background-color: var(--primary-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--primary-100);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .form-actions {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
            padding-top: var(--space-6);
            border-top: 2px solid var(--border-light);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .dashboard-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-grid">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="sidebar-brand">
                <span class="sidebar-brand-icon">üè•</span>
                <span class="sidebar-brand-text">MediConsultas</span>
            </div>

            <div class="sidebar-user">
                <div class="sidebar-user-name" id="userName">Cargando...</div>
                <div class="sidebar-user-role">Paciente</div>
            </div>

            <nav class="sidebar-nav">
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li class="sidebar-nav-item">
                        <a href="/pages/paciente/dashboard.html" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">üè†</span>
                            <span>Inicio</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="/pages/paciente/reservar-cita.html" class="sidebar-nav-link active">
                            <span class="sidebar-nav-icon">üìÖ</span>
                            <span>Reservar Cita</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="/pages/paciente/mis-citas.html" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">üìã</span>
                            <span>Mis Citas</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="/pages/paciente/perfil.html" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">üë§</span>
                            <span>Mi Perfil</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <button class="btn btn-danger btn-block" id="logoutBtn">
                    <span>üö™</span>
                    <span>Cerrar Sesi√≥n</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Header -->
            <div class="dashboard-header animate-fade-in">
                <h1 class="dashboard-title">Reservar Nueva Cita</h1>
                <p class="dashboard-subtitle">Complete los 5 pasos para agendar su consulta m√©dica</p>
            </div>

            <!-- Stepper -->
            <div class="stepper animate-slide-up">
                <div class="step active" id="stepIndicator1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Especialidad</div>
                </div>
                <div class="step" id="stepIndicator2">
                    <div class="step-circle">2</div>
                    <div class="step-label">M√©dico</div>
                </div>
                <div class="step" id="stepIndicator3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Fecha</div>
                </div>
                <div class="step" id="stepIndicator4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Hora</div>
                </div>
                <div class="step" id="stepIndicator5">
                    <div class="step-circle">5</div>
                    <div class="step-label">Confirmaci√≥n</div>
                </div>
            </div>

            <!-- Form Content -->
            <div class="form-content animate-slide-up" style="animation-delay: 0.1s;">
                <form id="citaForm">
                    <!-- Step 1: Seleccionar Especialidad -->
                    <div class="form-step active" id="step1">
                        <h2 style="margin-bottom: var(--space-4);">Paso 1: Seleccione la Especialidad</h2>
                        <div class="form-group">
                            <label for="especialidad" class="form-label form-label-required">Especialidad M√©dica</label>
                            <select id="especialidad" class="form-control" required>
                                <option value="">Cargando especialidades...</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" id="nextStep1">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Seleccionar M√©dico -->
                    <div class="form-step" id="step2">
                        <h2 style="margin-bottom: var(--space-4);">Paso 2: Seleccione el M√©dico</h2>
                        <div id="medicosContainer">
                            <div class="spinner-container">
                                <div class="spinner"></div>
                                <p>Cargando m√©dicos...</p>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" id="prevStep2">
                                ‚Üê Anterior
                            </button>
                            <button type="button" class="btn btn-primary" id="nextStep2">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Seleccionar Fecha -->
                    <div class="form-step" id="step3">
                        <h2 style="margin-bottom: var(--space-4);">Paso 3: Seleccione la Fecha</h2>
                        <div class="form-group">
                            <label for="fechaCita" class="form-label form-label-required">Fecha de la Cita</label>
                            <input type="date" id="fechaCita" class="form-control" required>
                            <small style="color: var(--text-tertiary); margin-top: var(--space-1); display: block;">
                                La fecha debe ser entre 2 horas y 60 d√≠as desde hoy
                            </small>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" id="prevStep3">
                                ‚Üê Anterior
                            </button>
                            <button type="button" class="btn btn-primary" id="nextStep3">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Seleccionar Hora -->
                    <div class="form-step" id="step4">
                        <h2 style="margin-bottom: var(--space-4);">Paso 4: Seleccione la Hora</h2>
                        <div id="horariosContainer">
                            <div class="spinner-container">
                                <div class="spinner"></div>
                                <p>Cargando horarios disponibles...</p>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" id="prevStep4">
                                ‚Üê Anterior
                            </button>
                            <button type="button" class="btn btn-primary" id="nextStep4">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 5: Motivo y Confirmaci√≥n -->
                    <div class="form-step" id="step5">
                        <h2 style="margin-bottom: var(--space-4);">Paso 5: Motivo de Consulta y Confirmaci√≥n</h2>

                        <div class="form-group">
                            <label for="motivoConsulta" class="form-label form-label-required">Motivo de la Consulta</label>
                            <textarea
                                id="motivoConsulta"
                                class="form-control"
                                rows="4"
                                placeholder="Describa el motivo de su consulta (m√≠nimo 10 caracteres)"
                                minlength="10"
                                required
                            ></textarea>
                            <small style="color: var(--text-tertiary); margin-top: var(--space-1); display: block;">
                                M√≠nimo 10 caracteres
                            </small>
                        </div>

                        <!-- Resumen -->
                        <h3 style="margin-top: var(--space-6); margin-bottom: var(--space-3);">Resumen de la Cita</h3>
                        <div class="summary-card">
                            <div class="summary-item">
                                <span class="summary-label">Especialidad:</span>
                                <span class="summary-value" id="summaryEspecialidad">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">M√©dico:</span>
                                <span class="summary-value" id="summaryMedico">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Fecha:</span>
                                <span class="summary-value" id="summaryFecha">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Hora:</span>
                                <span class="summary-value" id="summaryHora">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Consultorio:</span>
                                <span class="summary-value" id="summaryConsultorio">-</span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" id="prevStep5">
                                ‚Üê Anterior
                            </button>
                            <button type="submit" class="btn btn-success" id="submitBtn">
                                <span id="submitText">Confirmar Cita</span>
                                <span id="submitSpinner" class="spinner" style="display: none;"></span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="/js/main.js"></script>
    <script src="/js/utils/auth-guard.js"></script>
    <script>
        let currentStep = 1;
        const citaData = {
            especialidad: null,
            medico: null,
            fecha: null,
            hora: null,
            consultorio: null
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const user = getCurrentUser();
            if (!user || user.rol !== 'PACIENTE') {
                window.location.href = '/pages/auth/login.html';
                return;
            }

            document.getElementById('userName').textContent = user.username;
            document.getElementById('logoutBtn').addEventListener('click', () => {
                logout();
                window.location.href = '/pages/auth/login.html';
            });

            await loadEspecialidades();
            setupNavigation();
            setupForm();
        });

        async function loadEspecialidades() {
            const token = getToken();
            try {
                const response = await fetch(`${API_BASE_URL}/especialidades`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const especialidades = await response.json();

                const select = document.getElementById('especialidad');
                select.innerHTML = '<option value="">Seleccione una especialidad</option>';
                especialidades.filter(e => e.activo).forEach(esp => {
                    const option = document.createElement('option');
                    option.value = esp.idEspecialidad;
                    option.textContent = esp.nombre;
                    option.dataset.codigo = esp.codigo;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error al cargar especialidades');
            }
        }

        async function loadMedicos(idEspecialidad) {
            const token = getToken();
            const container = document.getElementById('medicosContainer');

            try {
                const response = await fetch(`${API_BASE_URL}/medicos/especialidad/${idEspecialidad}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const medicos = await response.json();

                if (medicos.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No hay m√©dicos disponibles para esta especialidad</p>';
                    return;
                }

                container.innerHTML = '<div class="doctor-grid"></div>';
                const grid = container.querySelector('.doctor-grid');

                medicos.forEach(medico => {
                    const card = document.createElement('div');
                    card.className = 'doctor-card';
                    card.dataset.idMedico = medico.idMedico;
                    card.innerHTML = `
                        <div class="doctor-info">
                            <div class="doctor-avatar">üë®‚Äç‚öïÔ∏è</div>
                            <div class="doctor-details">
                                <h4>Dr(a). ${medico.nombres} ${medico.apellidoPaterno}</h4>
                                <p>CMP: ${medico.numeroColegiatura}</p>
                                <p>${medico.telefono || 'Sin tel√©fono'}</p>
                            </div>
                        </div>
                    `;

                    card.addEventListener('click', () => {
                        document.querySelectorAll('.doctor-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        citaData.medico = {
                            id: medico.idMedico,
                            nombre: `Dr(a). ${medico.nombres} ${medico.apellidoPaterno} ${medico.apellidoMaterno}`
                        };
                    });

                    grid.appendChild(card);
                });
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p style="text-align: center; color: var(--error-600);">Error al cargar m√©dicos</p>';
            }
        }

        async function loadHorarios(idMedico, fecha) {
            const token = getToken();
            const container = document.getElementById('horariosContainer');

            try {
                const response = await fetch(`${API_BASE_URL}/horarios/medico/${idMedico}/fecha/${fecha}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const horarios = await response.json();

                if (horarios.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No hay horarios disponibles para esta fecha</p>';
                    return;
                }

                container.innerHTML = '<div class="time-slots"></div>';
                const slotsContainer = container.querySelector('.time-slots');

                horarios.forEach(horario => {
                    const slot = document.createElement('div');
                    slot.className = `time-slot ${horario.disponible ? '' : 'disabled'}`;
                    slot.textContent = horario.hora;

                    if (horario.disponible) {
                        slot.addEventListener('click', () => {
                            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                            slot.classList.add('selected');
                            citaData.hora = horario.hora;
                            citaData.consultorio = horario.consultorio;
                        });
                    }

                    slotsContainer.appendChild(slot);
                });
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p style="text-align: center; color: var(--error-600);">Error al cargar horarios</p>';
            }
        }

        function setupNavigation() {
            // Step 1
            document.getElementById('nextStep1').addEventListener('click', () => {
                const select = document.getElementById('especialidad');
                if (!select.value) {
                    alert('Por favor seleccione una especialidad');
                    return;
                }
                citaData.especialidad = {
                    id: select.value,
                    nombre: select.options[select.selectedIndex].text
                };
                loadMedicos(select.value);
                goToStep(2);
            });

            // Step 2
            document.getElementById('prevStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('nextStep2').addEventListener('click', () => {
                if (!citaData.medico) {
                    alert('Por favor seleccione un m√©dico');
                    return;
                }
                goToStep(3);
            });

            // Step 3
            document.getElementById('prevStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep3').addEventListener('click', () => {
                const fecha = document.getElementById('fechaCita').value;
                if (!fecha) {
                    alert('Por favor seleccione una fecha');
                    return;
                }

                const fechaSeleccionada = new Date(fecha);
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);

                const minFecha = new Date(hoy.getTime() + (2 * 60 * 60 * 1000));
                const maxFecha = new Date(hoy.getTime() + (60 * 24 * 60 * 60 * 1000));

                if (fechaSeleccionada < minFecha || fechaSeleccionada > maxFecha) {
                    alert('La fecha debe estar entre 2 horas y 60 d√≠as desde hoy');
                    return;
                }

                citaData.fecha = fecha;
                loadHorarios(citaData.medico.id, fecha);
                goToStep(4);
            });

            // Step 4
            document.getElementById('prevStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('nextStep4').addEventListener('click', () => {
                if (!citaData.hora) {
                    alert('Por favor seleccione un horario');
                    return;
                }
                updateSummary();
                goToStep(5);
            });

            // Step 5
            document.getElementById('prevStep5').addEventListener('click', () => goToStep(4));
        }

        function setupForm() {
            document.getElementById('citaForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const motivo = document.getElementById('motivoConsulta').value.trim();
                if (motivo.length < 10) {
                    alert('El motivo de consulta debe tener al menos 10 caracteres');
                    return;
                }

                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                const submitSpinner = document.getElementById('submitSpinner');

                submitBtn.disabled = true;
                submitText.style.display = 'none';
                submitSpinner.style.display = 'inline-block';

                const user = getCurrentUser();
                const token = getToken();

                const citaPayload = {
                    idPaciente: user.idReferencia,
                    idMedico: citaData.medico.id,
                    idConsultorio: citaData.consultorio.id,
                    fechaCita: citaData.fecha,
                    horaCita: citaData.hora,
                    motivoConsulta: motivo
                };

                try {
                    const response = await fetch(`${API_BASE_URL}/citas`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(citaPayload)
                    });

                    if (response.ok) {
                        alert('¬°Cita reservada exitosamente!');
                        window.location.href = '/pages/paciente/mis-citas.html';
                    } else {
                        const error = await response.json();
                        alert(`Error: ${error.message || 'No se pudo reservar la cita'}`);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al conectar con el servidor');
                } finally {
                    submitBtn.disabled = false;
                    submitText.style.display = 'inline';
                    submitSpinner.style.display = 'none';
                }
            });
        }

        function goToStep(step) {
            document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step').forEach((s, i) => {
                s.classList.remove('active', 'completed');
                if (i < step - 1) s.classList.add('completed');
                if (i === step - 1) s.classList.add('active');
            });

            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
        }

        function updateSummary() {
            document.getElementById('summaryEspecialidad').textContent = citaData.especialidad.nombre;
            document.getElementById('summaryMedico').textContent = citaData.medico.nombre;
            document.getElementById('summaryFecha').textContent = new Date(citaData.fecha).toLocaleDateString('es-PE', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('summaryHora').textContent = citaData.hora;
            document.getElementById('summaryConsultorio').textContent = citaData.consultorio.nombre || 'Por asignar';
        }

        // Configurar fechas m√≠nima y m√°xima
        const today = new Date();
        const minDate = new Date(today.getTime() + (2 * 60 * 60 * 1000));
        const maxDate = new Date(today.getTime() + (60 * 24 * 60 * 60 * 1000));

        document.getElementById('fechaCita').min = minDate.toISOString().split('T')[0];
        document.getElementById('fechaCita').max = maxDate.toISOString().split('T')[0];
    </script>
</body>
</html>
